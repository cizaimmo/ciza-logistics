<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Confirmation | Ciza Logistics</title>
<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
<style>
body{font-family:Arial;background:#111;color:#fff;text-align:center;padding:60px}
.card{
background:#1a1a1a;
padding:40px;
border-radius:20px;
max-width:600px;
margin:auto;
border:1px solid rgba(212,175,55,0.3);
}
.tracking{
font-size:22px;
color:#D4AF37;
margin:20px 0;
}
.qr{margin:20px auto;}
.btn{
background:#D4AF37;
color:#000;
padding:14px 26px;
border-radius:14px;
text-decoration:none;
font-weight:bold;
display:inline-block;
margin-top:20px;
}
</style>
</head>
<body>

<div class="card">
<h2>Envoi Confirm√©</h2>

<div class="tracking" id="trackingText"></div>

<canvas id="qrCanvas" class="qr"></canvas>

<a href="#" id="trackLink" class="btn">Suivre mon colis</a>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
apiKey: "AIzaSyCIUVom1diEV4ESa3QEcICOZRv0TNSydx8",
authDomain: "ciza-logistics.firebaseapp.com",
projectId: "ciza-logistics",
storageBucket: "ciza-logistics.firebasestorage.app",
messagingSenderId: "751524585771",
appId: "1:751524585771:web:6720db623a0ef70f56e56e"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const params = new URLSearchParams(window.location.search);
const tracking = params.get("tracking");

document.getElementById("trackingText").innerText = tracking;

const url = window.location.origin + "/tracking.html?code=" + tracking;

QRCode.toCanvas(document.getElementById("qrCanvas"), url);

document.getElementById("trackLink").href = url;

/* Generate OTP */
const otp = Math.floor(1000 + Math.random() * 9000);

await updateDoc(doc(db,"shipments",tracking),{
otpCode: otp,
status:"confirmed"
});
</script>

</body>
</html>
