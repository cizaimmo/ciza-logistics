<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Print Label | Ciza Logistics</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">

<style>
:root{
--gold:#D4AF37;
--black:#000;
--gray:#f2f2f2;
}

*{margin:0;padding:0;box-sizing:border-box;}
body{
font-family:'Inter',sans-serif;
background:#f2f2f2;
display:flex;
justify-content:center;
padding:20px;
}

/* FORMAT THERMIQUE 100x150 */
.label{
width:100mm;
min-height:150mm;
background:#fff;
padding:12mm 8mm;
position:relative;
border:1px solid #ddd;
}

.header{
display:flex;
justify-content:space-between;
align-items:center;
margin-bottom:10mm;
}

.logo{
height:28px;
}

.company{
font-weight:900;
font-size:14px;
letter-spacing:1px;
}

.tracking{
text-align:center;
font-weight:900;
font-size:18px;
margin-bottom:6mm;
}

.section{
margin-bottom:6mm;
}

.section h3{
font-size:10px;
text-transform:uppercase;
margin-bottom:2mm;
font-weight:900;
}

.text{
font-size:11px;
line-height:1.5;
}

.barcode{
margin:6mm 0;
text-align:center;
}

.qr{
text-align:center;
margin-top:3mm;
}

.divider{
border-top:1px dashed #000;
margin:5mm 0;
}

.signature{
margin-top:10mm;
}

.signature-line{
margin-top:10mm;
border-top:1px solid #000;
width:100%;
}

.footer{
position:absolute;
bottom:8mm;
left:8mm;
right:8mm;
font-size:8px;
text-align:center;
}

.actions{
text-align:center;
margin-top:20px;
}

.btn{
padding:10px 18px;
font-weight:800;
border-radius:10px;
border:none;
cursor:pointer;
margin:5px;
}

.print-btn{background:#000;color:#fff;}
.back-btn{background:var(--gold);color:#000;}

@media print{
body{background:#fff;padding:0;}
.actions{display:none;}
.label{border:none;}
}
</style>
</head>

<body>

<div>
<div class="label">

<div class="header">
<img src="https://raw.githubusercontent.com/cizaimmo/ciza-logistics/4b1ea6a2d3697e3982880984ee31dca42d8c52fc/logo.png" class="logo">
<div class="company">CIZA PARCEL</div>
</div>

<div class="tracking" id="trackingCode">...</div>

<div class="barcode">
<svg id="barcode"></svg>
</div>

<div class="qr" id="qrcode"></div>

<div class="divider"></div>

<div class="section">
<h3>Exp√©diteur</h3>
<div class="text" id="senderInfo"></div>
</div>

<div class="section">
<h3>Destinataire</h3>
<div class="text" id="receiverInfo"></div>
</div>

<div class="divider"></div>

<div class="section">
<h3>D√©tails colis</h3>
<div class="text" id="detailsInfo"></div>
</div>

<div class="signature">
<h3>R√©ception</h3>
<div class="signature-line"></div>
</div>

<div class="footer">
Ciza Logistics ‚Ä¢ Burundi & Rwanda ‚Ä¢ www.cizagroup.com
</div>

</div>

<div class="actions">
<button class="btn print-btn" onclick="window.print()">üñ® Imprimer</button>
<button class="btn back-btn" onclick="goBack()">‚¨Ö Retour Admin</button>
</div>

</div>

<script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
apiKey:"AIzaSyCIUVom1diEV4ESa3QEcICOZRv0TNSydx8",
authDomain:"ciza-logistics.firebaseapp.com",
projectId:"ciza-logistics"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const params = new URLSearchParams(window.location.search);
const tracking = params.get("tracking");

if(!tracking){
document.body.innerHTML="<h2>Tracking invalide</h2>";
}

const snap = await getDoc(doc(db,"shipments",tracking));

if(!snap.exists()){
document.body.innerHTML="<h2>Colis introuvable</h2>";
}

const d = snap.data();

document.getElementById("trackingCode").innerText = tracking;

document.getElementById("senderInfo").innerHTML =
`${d.senderName || ""}<br>
${d.senderPhone || ""}<br>
${d.fromProvince || ""} ${d.fromQuartier || ""}`;

document.getElementById("receiverInfo").innerHTML =
`${d.receiverName || ""}<br>
${d.receiverPhone || ""}<br>
${d.toProvince || ""} ${d.toQuartier || ""}`;

document.getElementById("detailsInfo").innerHTML =
`Service: ${d.serviceLabel || d.service || ""}<br>
Poids/Qt√©: ${d.weightOrQty || ""}<br>
Valeur d√©clar√©e: ${(d.declaredValue||0).toLocaleString("fr-FR")} BIF<br>
Paiement: ${d.paymentMethod || ""}<br>
Statut: ${d.status || ""}<br>
Chauffeur: ${d.assignedDriverName || d.assignedDriverId || "Non assign√©"}<br>
Cr√©√© le: ${d.createdAt?.toDate ? d.createdAt.toDate().toLocaleString() : ""}<br>
Livr√© le: ${d.deliveredAt?.toDate ? d.deliveredAt.toDate().toLocaleString() : ""}`;

JsBarcode("#barcode", tracking, {
format:"CODE128",
width:2,
height:50,
displayValue:false
});

new QRCode(document.getElementById("qrcode"), {
text: location.origin + "/tracking.html?code=" + tracking,
width:90,
height:90
});

window.goBack = function(){
window.history.back();
};
</script>

</body>
</html>
