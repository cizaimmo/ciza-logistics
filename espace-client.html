<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Espace Client | Ciza Logistics</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

<style>
body{
margin:0;
background:#0b0b0c;
font-family:Inter;
color:#fff;
}
.header{
padding:20px;
border-bottom:1px solid rgba(212,175,55,0.2);
display:flex;
justify-content:space-between;
align-items:center;
}
h1{
color:#D4AF37;
margin:0;
font-size:18px;
}
.container{
width:95%;
max-width:900px;
margin:30px auto;
}
.card{
background:#121214;
border:1px solid rgba(212,175,55,0.2);
padding:18px;
border-radius:18px;
margin-bottom:18px;
}
.badge{
padding:6px 12px;
border-radius:999px;
font-size:12px;
font-weight:900;
}
.created{background:#636e72;}
.in_transit{background:#0984e3;}
.delivered{background:#00b894;}
.price{
color:#D4AF37;
font-weight:900;
margin-top:6px;
}
.otp{
background:#6c5ce7;
display:inline-block;
margin-top:10px;
}
button{
background:#D4AF37;
border:none;
padding:8px 14px;
border-radius:12px;
font-weight:900;
cursor:pointer;
}
.logout{
background:transparent;
border:1px solid rgba(212,175,55,0.3);
color:#D4AF37;
}
.debug{
font-size:11px;
opacity:0.6;
margin-top:5px;
}
</style>
</head>
<body>

<div class="header">
<h1>Espace Client</h1>
<button class="logout" id="logoutBtn">Déconnexion</button>
</div>

<div class="container" id="list"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, query, where, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

const firebaseConfig = {
apiKey: "AIzaSyCIUVom1diEV4ESa3QEcICOZRv0TNSydx8",
authDomain: "ciza-logistics.firebaseapp.com",
projectId: "ciza-logistics"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

const list = document.getElementById("list");

document.getElementById("logoutBtn").onclick = async()=>{
await signOut(auth);
location.href="login.html";
};

onAuthStateChanged(auth,(user)=>{

if(!user){
location.href="login.html";
return;
}

console.log("UID CONNECTÉ :", user.uid);

const q = query(
collection(db,"shipments"),
where("ownerUid","==",user.uid)
);

onSnapshot(q,(snap)=>{

list.innerHTML="";

if(snap.empty){
list.innerHTML="<div class='card'>Aucun colis trouvé.</div>";
return;
}

snap.forEach(docSnap=>{
const d = docSnap.data();

list.innerHTML += `
<div class="card">
<b>${d.trackingCode || docSnap.id}</b>

<div class="badge ${d.status || "created"}">
${(d.status || "created").toUpperCase()}
</div>

<div class="price">
Prix: ${d.finalPrice || 0} BIF
</div>

${d.deliveryOTP ? `
<div class="badge otp">
OTP: ${d.deliveryOTP}
</div>` : ""}

<div class="debug">
ownerUid: ${d.ownerUid}
</div>

</div>
`;
});

});

});
</script>

</body>
</html>
