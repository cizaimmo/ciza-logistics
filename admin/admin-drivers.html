<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Driver Management | Ciza Logistics</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">

<style>
:root{
--gold:#D4AF37;
--black:#000;
--soft:#0f1115;
--card:#ffffff;
--muted:#6b7280;
--radius:18px;
}

*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Inter,Arial;background:#f4f6f9;color:#111;display:flex;min-height:100vh}

/* SIDEBAR */
.sidebar{
width:280px;
background:#000;
color:#fff;
display:flex;
flex-direction:column;
padding:20px 18px;
position:fixed;
height:100vh;
}
.logo-container{
text-align:center;
margin-bottom:25px;
}
.logo-container img{
height:85px;
filter:drop-shadow(0 0 25px rgba(212,175,55,0.4));
margin-bottom:10px;
}
.logo-title{
font-weight:900;
color:var(--gold);
letter-spacing:.5px;
font-size:14px;
}
.logo-sub{
font-size:11px;
opacity:.8;
margin-top:4px;
}

.nav a{
display:block;
padding:12px 14px;
border-radius:12px;
text-decoration:none;
color:#fff;
font-weight:800;
font-size:13px;
margin-bottom:8px;
}
.nav a:hover,
.nav a.active{
background:var(--gold);
color:#000;
}

.sidebar-bottom{
margin-top:auto;
}
.logout-btn{
background:var(--gold);
border:none;
padding:12px;
width:100%;
border-radius:12px;
font-weight:900;
cursor:pointer;
}

/* MAIN */
.main{
margin-left:280px;
flex:1;
padding:30px;
background:#f4f6f9;
min-height:100vh;
}

.header-hero{
display:flex;
align-items:center;
gap:20px;
margin-bottom:30px;
}

.header-hero img{
height:90px;
filter:drop-shadow(0 0 35px rgba(212,175,55,0.35));
}

.header-text h1{
font-size:22px;
font-weight:900;
}
.header-text p{
font-size:13px;
color:#555;
margin-top:6px;
font-weight:600;
}

/* KPI */
.kpi-grid{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
gap:16px;
margin-bottom:30px;
}
.kpi{
background:#000;
color:var(--gold);
padding:18px;
border-radius:16px;
text-align:center;
font-weight:900;
}
.kpi small{
display:block;
color:#fff;
opacity:.8;
margin-top:6px;
font-size:11px;
}

/* DRIVER CARD */
.driver-card{
background:#fff;
border-radius:16px;
padding:18px;
margin-bottom:14px;
border:1px solid rgba(0,0,0,0.05);
}
.driver-header{
display:flex;
justify-content:space-between;
align-items:center;
}
.status{
padding:6px 12px;
border-radius:999px;
font-size:11px;
font-weight:900;
color:#fff;
}
.status.active{background:#27ae60}
.status.inactive{background:#c0392b}

.meta{
font-size:12px;
margin-top:10px;
line-height:1.6;
}

.controls{
margin-top:12px;
display:flex;
gap:8px;
flex-wrap:wrap;
}
button{
background:var(--gold);
border:none;
padding:10px 12px;
border-radius:10px;
font-weight:900;
cursor:pointer;
font-size:12px;
}
.secondary{
background:#000;
color:var(--gold);
}

@media(max-width:900px){
.sidebar{position:relative;width:100%;height:auto}
.main{margin-left:0}
.header-hero{flex-direction:column;align-items:flex-start}
}
</style>
</head>

<body>

<!-- SIDEBAR -->
<div class="sidebar">
<div class="logo-container">
<img src="https://raw.githubusercontent.com/cizaimmo/ciza-logistics/4b1ea6a2d3697e3982880984ee31dca42d8c52fc/logo.png">
<div class="logo-title">CIZA LOGISTICS</div>
<div class="logo-sub">Driver Management Suite</div>
</div>

<div class="nav">
<a href="admin-parcel.html">üì¶ Colis</a>
<a href="admin-drivers.html" class="active">üöö Chauffeurs</a>
<a href="admin-driver-payments.html">üí∞ Paiements</a>
<a href="admin-bureau.html">üè¢ Bureau</a>
</div>

<div class="sidebar-bottom">
<button class="logout-btn" id="logoutBtn">D√©connexion</button>
</div>
</div>

<!-- MAIN -->
<div class="main">

<div class="header-hero">
<img src="https://raw.githubusercontent.com/cizaimmo/ciza-logistics/4b1ea6a2d3697e3982880984ee31dca42d8c52fc/logo.png">
<div class="header-text">
<h1>Driver Management</h1>
<p>Gestion compl√®te des chauffeurs ‚Ä¢ Performance ‚Ä¢ Paiements</p>
</div>
</div>

<div class="kpi-grid">
<div class="kpi"><div id="kpiTotal">0</div><small>Total chauffeurs</small></div>
<div class="kpi"><div id="kpiActive">0</div><small>Actifs</small></div>
<div class="kpi"><div id="kpiInactive">0</div><small>Inactifs</small></div>
<div class="kpi"><div id="kpiRevenue">0</div><small>Total g√©n√©r√©</small></div>
</div>

<div id="driverList"></div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, getDocs, doc, getDoc, updateDoc, query, where } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

/* FIREBASE */
const app = initializeApp({
apiKey:"AIzaSyCIUVom1diEV4ESa3QEcICOZRv0TNSydx8",
authDomain:"ciza-logistics.firebaseapp.com",
projectId:"ciza-logistics"
});
const db = getFirestore(app);
const auth = getAuth(app);

/* AUTH GUARD */
onAuthStateChanged(auth, async(user)=>{
if(!user){ location.href="../login.html"; return; }
const snap = await getDoc(doc(db,"users",user.uid));
if(!snap.exists()){ location.href="../login.html"; return; }
const data=snap.data();
if(data.role!=="admin" && data.role!=="superadmin"){
location.href="../login.html";
return;
}
});

/* LOGOUT */
document.getElementById("logoutBtn").addEventListener("click",async()=>{
await signOut(auth);
location.href="../login.html";
});

/* LOAD DRIVERS */
const driverList=document.getElementById("driverList");
const kpiTotal=document.getElementById("kpiTotal");
const kpiActive=document.getElementById("kpiActive");
const kpiInactive=document.getElementById("kpiInactive");
const kpiRevenue=document.getElementById("kpiRevenue");

async function loadDrivers(){
let total=0,active=0,inactive=0,revenue=0;
let html="";

const snap=await getDocs(query(collection(db,"users"),where("role","==","driver")));

snap.forEach(docSnap=>{
const d=docSnap.data();
total++;

const isActive=d.isActive!==false;
if(isActive) active++; else inactive++;

const driverRevenue=d.totalRevenue||0;
revenue+=driverRevenue;

html+=`
<div class="driver-card">
<div class="driver-header">
<div><b>${d.fullName||d.name||docSnap.id}</b></div>
<div class="status ${isActive?"active":"inactive"}">
${isActive?"ACTIF":"INACTIF"}
</div>
</div>

<div class="meta">
T√©l√©phone: ${d.phone||"‚Äî"}<br>
Email: ${d.email||"‚Äî"}<br>
Province: ${d.province||"‚Äî"}<br>
Quartier: ${d.quartier||"‚Äî"}<br>
Livraisons: ${d.totalDeliveries||0}<br>
Total g√©n√©r√©: ${(driverRevenue).toLocaleString("fr-FR")} BIF
</div>

<div class="controls">
<button onclick="toggleStatus('${docSnap.id}',${isActive})">
${isActive?"D√©sactiver":"Activer"}
</button>
<button class="secondary" onclick="alert('Module dossier bient√¥t disponible')">
Dossier
</button>
</div>
</div>
`;
});

driverList.innerHTML=html;
kpiTotal.innerText=total;
kpiActive.innerText=active;
kpiInactive.innerText=inactive;
kpiRevenue.innerText=revenue.toLocaleString("fr-FR")+" BIF";
}

window.toggleStatus=async function(id,current){
await updateDoc(doc(db,"users",id),{
isActive:!current
});
loadDrivers();
};

loadDrivers();
</script>

</body>
</html>
