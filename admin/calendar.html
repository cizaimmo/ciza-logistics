<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calendrier RDV | Admin</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Inter,Arial;background:#0b0b0c;color:#fff}

header{
background:#000;
padding:18px 20px;
display:flex;
justify-content:space-between;
align-items:center;
border-bottom:1px solid rgba(212,175,55,.3);
}

.logo img{height:60px}
.logout{
background:#D4AF37;
color:#000;
border:none;
padding:10px 14px;
border-radius:12px;
font-weight:900;
cursor:pointer;
}

.container{
max-width:1100px;
margin:auto;
padding:25px;
}

.section{
background:#121214;
border-radius:18px;
padding:20px;
margin-bottom:25px;
border:1px solid rgba(212,175,55,.25);
}

h2{
font-size:16px;
margin-bottom:15px;
color:#D4AF37;
}

input,select,textarea{
width:100%;
background:#1c1c1f;
border:1px solid rgba(212,175,55,.3);
border-radius:12px;
padding:10px;
color:#fff;
font-size:13px;
margin-bottom:10px;
}

textarea{resize:none;height:70px}

button{
background:#D4AF37;
border:none;
padding:12px;
border-radius:12px;
font-weight:900;
cursor:pointer;
color:#000;
}

.appointment{
background:#1c1c1f;
padding:15px;
border-radius:14px;
margin-bottom:12px;
border-left:6px solid #555;
font-size:13px;
}

.badge{
display:inline-block;
padding:4px 8px;
border-radius:999px;
font-size:10px;
font-weight:900;
margin-bottom:6px;
}

.pickup{background:#D4AF37;color:#000}
.client{background:#2980b9}
.driver{background:#27ae60}
.finance{background:#c0392b}
.other{background:#555}

.footer{
text-align:center;
padding:15px;
font-size:11px;
color:#aaa;
border-top:1px solid rgba(212,175,55,.2);
}

@media(min-width:900px){
.form-grid{
display:grid;
grid-template-columns:1fr 1fr;
gap:15px;
}
}
</style>
</head>

<body>

<header>
<div class="logo">
<img src="https://raw.githubusercontent.com/cizaimmo/ciza-logistics/4b1ea6a2d3697e3982880984ee31dca42d8c52fc/logo.png">
</div>
<button class="logout" id="logoutBtn">Déconnexion</button>
</header>

<div class="container">

<div class="section">
<h2>Créer un rendez-vous</h2>

<div class="form-grid">
<input type="text" id="title" placeholder="Titre du rendez-vous">

<select id="type">
<option value="pickup">Pickup</option>
<option value="client">Client</option>
<option value="driver">Driver</option>
<option value="finance">Finance</option>
<option value="other">Other</option>
</select>

<input type="date" id="date">
<input type="time" id="time">

<input type="text" id="province" placeholder="Province">
<input type="text" id="quartier" placeholder="Quartier">
</div>

<textarea id="notes" placeholder="Notes internes..."></textarea>

<button id="createBtn">Créer RDV</button>
</div>

<div class="section">
<h2>Rendez-vous planifiés</h2>
<div id="appointmentsList"></div>
</div>

</div>

<div class="footer">
Ciza Logistics • Planning interne sécurisé • © 2026
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, onSnapshot, serverTimestamp, deleteDoc, doc, updateDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

const app = initializeApp({
apiKey:"AIzaSyCIUVom1diEV4ESa3QEcICOZRv0TNSydx8",
authDomain:"ciza-logistics.firebaseapp.com",
projectId:"ciza-logistics"
});
const db = getFirestore(app);
const auth = getAuth(app);

let currentUser;

onAuthStateChanged(auth, async(user)=>{
if(!user){location.href="../login.html";return;}
const snap=await getDoc(doc(db,"users",user.uid));
if(!snap.exists()){location.href="../login.html";return;}
if(!["admin","superadmin","bureau"].includes(snap.data().role)){
location.href="../login.html";return;
}
currentUser=user;
loadAppointments();
});

document.getElementById("logoutBtn").onclick=()=>signOut(auth);

const list=document.getElementById("appointmentsList");

function loadAppointments(){
onSnapshot(collection(db,"appointments"),(snapshot)=>{
list.innerHTML="";
snapshot.forEach(docSnap=>{
const d=docSnap.data();
const div=document.createElement("div");
div.className="appointment";
div.innerHTML=`
<div class="badge ${d.type}">${d.type.toUpperCase()}</div>
<strong>${d.title}</strong><br>
${d.date} • ${d.time}<br>
${d.province || ""} ${d.quartier || ""}<br>
${d.notes || ""}<br>
<button onclick="complete('${docSnap.id}')">Terminé</button>
<button onclick="removeAppt('${docSnap.id}')">Supprimer</button>
`;
list.appendChild(div);
});
});
}

document.getElementById("createBtn").onclick=async()=>{
const title=document.getElementById("title").value.trim();
const type=document.getElementById("type").value;
const date=document.getElementById("date").value;
const time=document.getElementById("time").value;
if(!title || !date || !time)return;

await addDoc(collection(db,"appointments"),{
title,
type,
date,
time,
province:document.getElementById("province").value,
quartier:document.getElementById("quartier").value,
notes:document.getElementById("notes").value,
status:"scheduled",
createdBy:currentUser.uid,
createdAt:serverTimestamp()
});

document.querySelectorAll("input,textarea").forEach(i=>i.value="");
};

window.complete=async(id)=>{
await updateDoc(doc(db,"appointments",id),{status:"completed"});
};

window.removeAppt=async(id)=>{
await deleteDoc(doc(db,"appointments",id));
};
</script>

</body>
</html>
