<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ciza Logistics | Admin Dashboard</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">

<style>
:root{
--gold:#D4AF37;
--black:#0e0e11;
--soft:#15151b;
--border:rgba(212,175,55,0.25);
--muted:#a5a5a5;
}

*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Inter',sans-serif;background:var(--black);color:#fff;}

.layout{
display:flex;
min-height:100vh;
}

/* SIDEBAR */
.sidebar{
width:260px;
background:#000;
border-right:1px solid var(--border);
padding:25px 20px;
display:flex;
flex-direction:column;
}

.logo{
text-align:center;
margin-bottom:30px;
}
.logo img{
height:95px;
}

.menu a{
display:block;
color:#fff;
text-decoration:none;
padding:12px 15px;
border-radius:12px;
margin-bottom:8px;
font-weight:700;
}
.menu a:hover{
background:rgba(212,175,55,0.15);
color:var(--gold);
}

.logout{
margin-top:auto;
padding:12px;
background:var(--gold);
color:#000;
border:none;
border-radius:12px;
font-weight:900;
cursor:pointer;
}

/* CONTENT */
.content{
flex:1;
padding:40px;
}

.header{
display:flex;
justify-content:space-between;
align-items:center;
margin-bottom:35px;
}

.header h1{
color:var(--gold);
}

.kpi-grid{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
gap:20px;
margin-bottom:40px;
}

.kpi-card{
background:var(--soft);
border:1px solid var(--border);
padding:25px;
border-radius:18px;
text-align:center;
}

.kpi-card h2{
font-size:32px;
color:var(--gold);
margin-bottom:5px;
}

.section{
background:var(--soft);
padding:25px;
border-radius:18px;
border:1px solid var(--border);
margin-bottom:25px;
}

.footer{
margin-top:40px;
text-align:center;
color:var(--muted);
font-size:13px;
}

@media(max-width:900px){
.layout{flex-direction:column;}
.sidebar{width:100%;flex-direction:row;overflow-x:auto;}
.menu{display:flex;gap:10px;}
.logout{margin-top:0;margin-left:auto;}
}
</style>
</head>

<body>

<div class="layout">

<!-- SIDEBAR -->
<div class="sidebar">
<div class="logo">
<img src="https://raw.githubusercontent.com/cizaimmo/ciza-logistics/4b1ea6a2d3697e3982880984ee31dca42d8c52fc/logo.png">
</div>

<div class="menu">
<a href="dashboard.html">Dashboard</a>
<a href="shipments.html">Colis</a>
<a href="drivers.html">Chauffeurs</a>
<a href="driver-payments.html">Paiements</a>
<a href="messaging.html">Messagerie</a>
<a href="calendar.html">Calendrier</a>
</div>

<button class="logout" id="logoutBtn">Déconnexion</button>
</div>

<!-- CONTENT -->
<div class="content">

<div class="header">
<h1>Admin Dashboard</h1>
<div id="adminName"></div>
</div>

<div class="kpi-grid">
<div class="kpi-card">
<h2 id="kpiCreated">0</h2>
<div>Colis créés</div>
</div>

<div class="kpi-card">
<h2 id="kpiPending">0</h2>
<div>Paiement en attente</div>
</div>

<div class="kpi-card">
<h2 id="kpiTransit">0</h2>
<div>En transit</div>
</div>

<div class="kpi-card">
<h2 id="kpiDelivered">0</h2>
<div>Livrés</div>
</div>

<div class="kpi-card">
<h2 id="kpiRevenue">0</h2>
<div>Revenus (BIF)</div>
</div>
</div>

<div class="section">
<h3>Résumé activité</h3>
<p id="summaryText">Chargement...</p>
</div>

<div class="footer">
© 2026 Ciza Logistics — ERP Administration
</div>

</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

const app = initializeApp({
apiKey:"AIzaSyCIUVom1diEV4ESa3QEcICOZRv0TNSydx8",
authDomain:"ciza-logistics.firebaseapp.com",
projectId:"ciza-logistics"
});

const db = getFirestore(app);
const auth = getAuth(app);

const logoutBtn = document.getElementById("logoutBtn");

logoutBtn.onclick = async()=>{
await signOut(auth);
window.location.href="../login.html";
};

onAuthStateChanged(auth, async(user)=>{
if(!user){
window.location.href="../login.html";
return;
}

document.getElementById("adminName").innerText = user.email;

const snap = await getDocs(collection(db,"shipments"));

let created=0,pending=0,transit=0,delivered=0,revenue=0;

snap.forEach(doc=>{
const d = doc.data();

created++;

if(d.status==="payment_under_review") pending++;
if(d.status==="in_transit") transit++;
if(d.status==="delivered"){
delivered++;
revenue += d.finalPrice || 0;
}
});

document.getElementById("kpiCreated").innerText = created;
document.getElementById("kpiPending").innerText = pending;
document.getElementById("kpiTransit").innerText = transit;
document.getElementById("kpiDelivered").innerText = delivered;
document.getElementById("kpiRevenue").innerText = revenue.toLocaleString("fr-FR");

document.getElementById("summaryText").innerText =
`${created} colis au total, ${delivered} livrés, ${pending} paiements en attente.`;
});
</script>

</body>
</html>
