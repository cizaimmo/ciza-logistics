<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard | Ciza Logistics</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;}

body{
font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Inter;
background:#0f0f10;
color:#fff;
}

header{
background:#000;
padding:20px;
text-align:center;
border-bottom:1px solid rgba(212,175,55,0.3);
}

header img{
height:80px;
margin-bottom:10px;
}

.container{
width:95%;
max-width:1200px;
margin:30px auto;
}

.welcome{
font-size:18px;
margin-bottom:25px;
}

.kpi-grid{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
gap:20px;
}

.kpi{
background:#000;
padding:25px;
border-radius:20px;
border:1px solid rgba(212,175,55,0.3);
text-align:center;
}

.kpi h3{
font-size:14px;
color:#bbb;
margin-bottom:10px;
}

.kpi span{
font-size:28px;
font-weight:900;
color:#D4AF37;
}

.logout{
margin-top:40px;
text-align:center;
}

button{
padding:14px 24px;
border:none;
border-radius:14px;
background:#D4AF37;
color:#000;
font-weight:900;
cursor:pointer;
}

footer{
margin-top:60px;
padding:30px;
text-align:center;
font-size:12px;
color:#777;
border-top:1px solid rgba(212,175,55,0.2);
}
</style>
</head>

<body>

<header>
<img src="https://raw.githubusercontent.com/cizaimmo/ciza-logistics/4b1ea6a2d3697e3982880984ee31dca42d8c52fc/logo.png">
<div>Administration Ciza Logistics</div>
</header>

<div class="container">

<div class="welcome" id="welcomeText">
Chargement...
</div>

<div class="kpi-grid">

<div class="kpi">
<h3>Total Chauffeurs</h3>
<span id="driversCount">0</span>
</div>

<div class="kpi">
<h3>Total Colis</h3>
<span id="shipmentsCount">0</span>
</div>

</div>

<div class="logout">
<button onclick="logout()">Déconnexion</button>
</div>

</div>

<footer>
© 2026 Ciza Logistics – Division de Ciza Group
</footer>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, collection, getDocs, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig={
apiKey:"AIzaSyCIUVom1diEV4ESa3QEcICOZRv0TNSydx8",
authDomain:"ciza-logistics.firebaseapp.com",
projectId:"ciza-logistics"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);

onAuthStateChanged(auth,async(user)=>{

if(!user){
location.href="/login.html";
return;
}

const snap=await getDoc(doc(db,"users",user.uid));

if(!snap.exists()){
alert("Compte non trouvé.");
location.href="/login.html";
return;
}

const data=snap.data();

if(data.role!=="admin" && data.role!=="superadmin"){
alert("Accès refusé.");
location.href="/login.html";
return;
}

document.getElementById("welcomeText").innerText=
"Bienvenue, " + data.fullName;

/* KPI Drivers */
const driversSnap=await getDocs(collection(db,"users"));
let driverCount=0;

driversSnap.forEach(doc=>{
if(doc.data().role==="driver") driverCount++;
});

document.getElementById("driversCount").innerText=driverCount;

/* KPI Shipments */
const shipmentsSnap=await getDocs(collection(db,"shipments"));
document.getElementById("shipmentsCount").innerText=shipmentsSnap.size;

});

window.logout=function(){
signOut(auth);
location.href="/login.html";
};

</script>

</body>
</html>
